<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>🎉 صانع فيديو التهنئة</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
</head>
<body class="bg-dark text-white p-4">

  <div class="container text-center">
    <h2 class="mb-4">🎉 صانع فيديو التهنئة</h2>

    <input type="url" id="videoUrl" class="form-control my-3" placeholder="رابط الفيديو (MP4)">
    <input type="text" id="greeting" class="form-control my-3" placeholder="التهنئة (مثال: عيدكم مبارك)">
    <input type="text" id="greeter" class="form-control my-3" placeholder="اسم المُرسل (مثال: مع تحيات محمد)">

    <button class="btn btn-primary" onclick="generateVideo()">✨ انشئ الفيديو</button>

    <div id="status" class="mt-3"></div>
    <a id="downloadLink" class="btn btn-success mt-3" style="display:none">📥 تحميل الفيديو</a>
  </div>

  <script>
    async function generateVideo() {
      const videoUrl = document.getElementById("videoUrl").value.trim();
      const greeting = document.getElementById("greeting").value.trim();
      const greeter = document.getElementById("greeter").value.trim();
      const status = document.getElementById("status");
      const link = document.getElementById("downloadLink");

      if (!videoUrl || !greeting || !greeter) {
        alert("يرجى تعبئة جميع الحقول");
        return;
      }

      status.innerText = "⏳ جاري معالجة الفيديو...";
      link.style.display = "none";

      try {
        const response = await fetch("https://ffmpeg-vercel-api.vercel.app/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ videoUrl, greeting, greeter })
        });

        if (!response.ok) throw new Error("فشل إنشاء الفيديو");

        const blob = await response.blob();
        const videoURL = URL.createObjectURL(blob);
        link.href = videoURL;
        link.download = "greeting.mp4";
        link.style.display = "inline-block";
        status.innerText = "✅ تم إنشاء الفيديو!";

      } catch (err) {
        console.error(err);
        status.innerText = "❌ حدث خطأ أثناء إنشاء الفيديو";
      }
    }
  </script>

</body>
</html>
